<!DOCTYPE html>
<html lang="en">
<head>
    <title>ETH Lending</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.2.9/dist/web3.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #FFFFFF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        button {
            background-color: #304ffe;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #536dfe;
        }

        button:active {
            background-color: #0026ca;
        }
    </style>
</head>

<body>
    <button id="connectButton">Connect</button>
    <button id="depositButton">Deposit 1 ETH</button>
    <button id="depositCollateralButton">Deposit 1 ETH as Collateral</button>
    <div>
        <input id="loanAmountInput" type="text" placeholder="Enter loan amount" />
        <button id="createLoanButton">Create Loan</button>
    </div>
    <button id="repayLoanButton">Repay Loan</button>
    <button id="withdrawCollateralButton">Withdraw Collateral</button>

    <script>
        const web3 = new Web3(window.ethereum);
        const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "borrower",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "CollateralWithdrawn",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "createLoan",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deposit",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "depositor",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Deposit",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "depositCollateral",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "borrower",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "LoanCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "borrower",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "LoanRepaid",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "repayLoan",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "withdrawCollateral",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "collateral",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "loans",
		"outputs": [
			{
				"internalType": "bool",
				"name": "isActive",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "collateral",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "LTV_RATIO",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalPool",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]; // Add contract ABI here
        const contractAddress = "0x85DB6F29409dA1d2e29f3390C6f7AED95d796E6D"; // Add contract address here
        const contract = new web3.eth.Contract(contractABI, contractAddress);
        let accounts = [];

        async function connect() {
    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    console.log("Connected: ", accounts[0]);
    window.ethereum.on('accountsChanged', function (accounts) {
        // Time to reload your interface with accounts[0]!
        console.log("Account changed: ", accounts[0]);
    });
}

        async function deposit() {
            await contract.methods.deposit().send({ from: accounts[0], value: web3.utils.toWei('1', 'ether') });
            console.log("Deposit successful");
        }

        async function depositCollateral() {
            await contract.methods.depositCollateral().send({ from: accounts[0], value: web3.utils.toWei('1', 'ether') });
            console.log("Collateral deposit successful");
        }

        async function createLoan() {
            const loanAmount = document.getElementById('loanAmountInput').value;
            await contract.methods.createLoan(web3.utils.toWei(loanAmount, 'ether')).send({ from: accounts[0] });
            console.log("Loan created");
        }


        async function repayLoan() {
            const { isActive, amount } = await contract.methods.getLoanDetails(accounts[0]).call();
            if (!isActive) return console.log("No active loan found");
            await contract.methods.repayLoan().send({ from: accounts[0], value: amount });
            console.log("Loan repaid");
        }

        async function withdrawCollateral() {
            const collateralBalance = await contract.methods.getCollateralBalance(accounts[0]).call();
            await contract.methods.withdrawCollateral(collateralBalance).send({ from: accounts[0] });
            console.log("Collateral withdrawn");
        }

        document.getElementById('connectButton').addEventListener('click', connect);
        document.getElementById('depositButton').addEventListener('click', deposit);
        document.getElementById('depositCollateralButton').addEventListener('click', depositCollateral);
        document.getElementById('createLoanButton').addEventListener('click', createLoan);
        document.getElementById('repayLoanButton').addEventListener('click', repayLoan);
        document.getElementById('withdrawCollateralButton').addEventListener('click', withdrawCollateral);
    </script>
</body>
</html>
